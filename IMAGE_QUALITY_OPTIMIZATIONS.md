# 证件拍摄清晰度优化方法

## 已实现的优化

### 1. **对焦优化** ⭐ 最重要

#### 对焦模式
- **Continuous 对焦**：持续微调，适应手持抖动
- **Macro 模式**：微距模式，适合近距离拍摄
- **5cm 对焦距离**：经过测试的最佳距离

#### 双重对焦策略
1. 初始对焦（500ms 后）：应用 continuous + macro + 5cm
2. 二次锁定（700ms 后）：应用 single + macro + 5cm，确保对焦锁定

#### 拍照前对焦锁定
- 在按下快门时，再次触发 single 对焦模式
- 等待 100ms 让对焦锁定后再拍照

### 2. **分辨率优化**

- **4K 分辨率**：`ideal: 4096x2160`
- **引导相机选择**：高分辨率要求会引导系统选择主相机
- **拍照时请求最大分辨率**：`imageWidth: 4096, imageHeight: 2160`

### 3. **曝光和白平衡优化**

#### 曝光设置
- **Manual 曝光模式**：手动曝光确保一致性
- **曝光补偿 +0.2**：轻微增加曝光，提升文字可见度
- **自动填充光**：`fillLightMode: 'auto'`

#### 白平衡
- **自动白平衡**：确保颜色准确

### 4. **图像后处理增强** 🆕

#### 对比度和亮度调整
```javascript
contrast: 1.2    // 增加对比度 20%
brightness: 5    // 轻微增加亮度
```

#### 处理流程
1. 拍摄原始照片
2. 应用对比度和亮度增强
3. 输出增强后的图像

**效果**：
- ✅ 文字更清晰
- ✅ 对比度更高
- ✅ 适合 OCR 识别

### 5. **高质量图像捕获**

#### ImageCapture API（优先）
- 使用原生相机 API
- 直接获取高质量图像
- 支持最大分辨率

#### Canvas 回退
- 使用实际视频分辨率
- 高质量渲染：`imageSmoothingQuality: 'high'`
- JPEG 质量：0.98（接近无损）

## 优化效果

### 对焦优化
- ✅ 持续对焦适应手持抖动
- ✅ 5cm 距离锁定最佳清晰度
- ✅ 拍照前再次锁定对焦

### 图像质量
- ✅ 4K 分辨率
- ✅ 对比度增强
- ✅ 亮度优化

### 曝光控制
- ✅ 手动曝光模式
- ✅ 曝光补偿
- ✅ 自动填充光

## 使用建议

### 拍摄距离
- **最佳距离**：5-10cm
- **对焦距离锁定**：5cm

### 拍摄环境
- **光线充足**：确保有足够的光线
- **避免反光**：避免强光直射证件
- **稳定手持**：尽量保持稳定

### 拍摄技巧
1. 将证件放在框架内
2. 保持 5-10cm 距离
3. 等待对焦完成（看到清晰的文字）
4. 按下快门
5. 系统会自动应用图像增强

## 技术细节

### 对焦时间线
```
0ms    - 相机启动
500ms  - 应用 continuous + macro + 5cm 对焦
700ms  - 应用 single + macro + 5cm 锁定对焦
拍照时 - 再次触发 single 对焦，等待 100ms 后拍照
```

### 图像处理流程
```
原始图像 → 对比度增强(1.2x) → 亮度调整(+5) → 输出增强图像
```

### 分辨率策略
```
请求: 4096x2160 (4K)
实际: 根据设备能力，至少 1920x1080
拍照: 请求最大分辨率
```

## 未来可能的优化

1. **锐化算法**：添加锐化滤镜
2. **去噪处理**：减少图像噪点
3. **边缘检测**：自动裁剪证件区域
4. **OCR 预处理**：针对 OCR 的专门优化
5. **多帧合成**：拍摄多张照片合成一张更清晰的

